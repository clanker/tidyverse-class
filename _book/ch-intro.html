<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 tibbles, ggplot2, and the tidyverse | Hitchhiker’s Guide to the Tidyverse (and Statistical Learning in R)</title>
  <meta name="description" content="A quick exploration of tidyverse capabilities and implementation of statistical learning methodology for current R programmers" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 tibbles, ggplot2, and the tidyverse | Hitchhiker’s Guide to the Tidyverse (and Statistical Learning in R)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A quick exploration of tidyverse capabilities and implementation of statistical learning methodology for current R programmers" />
  <meta name="github-repo" content="clanker/tidyverse-class" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 tibbles, ggplot2, and the tidyverse | Hitchhiker’s Guide to the Tidyverse (and Statistical Learning in R)" />
  
  <meta name="twitter:description" content="A quick exploration of tidyverse capabilities and implementation of statistical learning methodology for current R programmers" />
  

<meta name="author" content="Cory Lanker" />


<meta name="date" content="2019-07-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html">
<link rel="next" href="ch-dplyr.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro to the tidyverse</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="ch-intro.html"><a href="ch-intro.html"><i class="fa fa-check"></i><b>1</b> tibbles, ggplot2, and the <em>tidyverse</em></a><ul>
<li class="chapter" data-level="1.1" data-path="ch-intro.html"><a href="ch-intro.html#tibbles-boston-housing-data"><i class="fa fa-check"></i><b>1.1</b> Tibbles: Boston housing data</a></li>
<li class="chapter" data-level="1.2" data-path="ch-intro.html"><a href="ch-intro.html#ggplot2-and-eda"><i class="fa fa-check"></i><b>1.2</b> ggplot2 and EDA</a></li>
<li class="chapter" data-level="1.3" data-path="ch-intro.html"><a href="ch-intro.html#many-plotting-options"><i class="fa fa-check"></i><b>1.3</b> Many plotting options</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ch-dplyr.html"><a href="ch-dplyr.html"><i class="fa fa-check"></i><b>2</b> dplyr and tidyr</a><ul>
<li class="chapter" data-level="2.1" data-path="ch-dplyr.html"><a href="ch-dplyr.html#hoofin-it-with-dplyr"><i class="fa fa-check"></i><b>2.1</b> Hoofin’ it with dplyr</a></li>
<li class="chapter" data-level="2.2" data-path="ch-dplyr.html"><a href="ch-dplyr.html#tidyr-and-relational-data"><i class="fa fa-check"></i><b>2.2</b> tidyr and relational data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch-rlang.html"><a href="ch-rlang.html"><i class="fa fa-check"></i><b>3</b> dplyr closures and rlang</a><ul>
<li class="chapter" data-level="3.1" data-path="ch-rlang.html"><a href="ch-rlang.html#trying-to-understand-the-closure-functions"><i class="fa fa-check"></i><b>3.1</b> Trying to understand the closure functions</a></li>
<li class="chapter" data-level="3.2" data-path="ch-rlang.html"><a href="ch-rlang.html#tidy-evaluation-with-rlang"><i class="fa fa-check"></i><b>3.2</b> Tidy evaluation with rlang</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch-caret.html"><a href="ch-caret.html"><i class="fa fa-check"></i><b>4</b> caret Functionality</a></li>
<li class="chapter" data-level="5" data-path="ch-mlr.html"><a href="ch-mlr.html"><i class="fa fa-check"></i><b>5</b> the Machine Learning with R package</a></li>
<li class="chapter" data-level="6" data-path="ch-keras.html"><a href="ch-keras.html"><i class="fa fa-check"></i><b>6</b> implementing neural networks in R</a></li>
<li class="chapter" data-level="7" data-path="ch-tips.html"><a href="ch-tips.html"><i class="fa fa-check"></i><b>7</b> Tips and tricks</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Hitchhiker’s Guide to the Tidyverse (and Statistical Learning in R)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch:intro" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> tibbles, ggplot2, and the <em>tidyverse</em></h1>
<p>The tidyverse universe includes:</p>
<pre><code>## ── Attaching packages ──────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.2.0     ✔ purrr   0.3.2
## ✔ tibble  2.1.3     ✔ dplyr   0.8.1
## ✔ tidyr   0.8.3     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ─────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<p>In general, the tidyverse is the following:</p>
<ol style="list-style-type: decimal">
<li>provided the <code>pipe</code> command <code>%&gt;%</code></li>
</ol>
<ul>
<li><code>x %&gt;% f(y, z, ...)</code> is <code>f(x, y, z, ...)</code></li>
<li>allows chained commands for better coherence</li>
<li>e.g., <code>mtcars %&gt;% apply(2, mean)</code> is error without <code>tidyr::%&gt;%</code></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><code>tibble</code> is the improved data structure of the tidyverse</li>
</ol>
<ul>
<li>easier to read-in data to a useful format</li>
<li>automatic type conversion</li>
<li>nicer printing options</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><code>dplyr</code> provides tibble manipulation commands</li>
</ol>
<ul>
<li>understandable data processing with <code>pipe</code> streams</li>
<li><strong>filter</strong> data faster</li>
<li><strong>arrange</strong> rows of data easily</li>
<li><strong>select</strong> columns quickly</li>
<li><strong>mutate</strong> variables</li>
<li><strong>summarize</strong> according to <code>group_by()</code></li>
<li>also provides SQL relational operations</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><code>ggplot2</code> is a plotting syntax (grammar of graphics)</li>
</ol>
<ul>
<li><code>qplot()</code> provides a sensible <strong>q</strong>uick <strong>plot</strong></li>
<li>apply plot types to data rather than the reverse</li>
<li>e.g. <code>ggplot(data) + plot_type(aes(xvar, yvar, groups), options)</code></li>
<li>allows grid of plots by group using <strong>facets</strong></li>
<li>overlays statistical summaries, e.g. <code>+ geom_smooth(x, y)</code></li>
<li>“add” options such as transformed axes, labels, coordinates, etc.</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li><code>readr</code> is a faster, less painful read-in method</li>
</ol>
<ul>
<li><code>read_fun</code> denotes <code>readr</code> functions (instead of <code>read.fun</code>)</li>
<li>guesses column types</li>
<li>offers writing functions, too</li>
<li>allows read and write with RDS, R’s binary format</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li><code>tidyr</code> recharacterizes tibbles</li>
</ol>
<ul>
<li><code>spread()</code> turns key and value columns into key-category columns</li>
<li>e.g., <code>state, year, pop</code> into <code>state, 1990, 1991, ...</code> of pop values</li>
<li><code>gather()</code> turns expands data frames by condensing columns</li>
<li>e.g., condenses <code>1990, 1991, ...</code> into two <code>year, pop</code> columns</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>Other helpful tidyverse packages:</li>
</ol>
<ul>
<li><code>stringr</code> offers many useful <code>str_fun</code> operations</li>
<li><code>forcats</code> has operations _for cat_egorical variables</li>
<li><code>lubridate</code> provides date and time control</li>
<li><code>purrr</code></li>
</ul>
<p>The examples I’ll use in the next few chapters are the Boston housing database and the Lahman baseball database. By doing analysis on these two data sets, I hope to introduce the power of the tidyverse.</p>
<div id="tibbles-boston-housing-data" class="section level2">
<h2><span class="header-section-number">1.1</span> Tibbles: Boston housing data</h2>
<p>Load, convert, print a tibble.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Convert to a tibble so it prints nicely</span>
<span class="kw">library</span>(MASS)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">select &lt;-<span class="st"> </span>dplyr<span class="op">::</span>select
boston &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(MASS<span class="op">::</span>Boston)
boston</code></pre></div>
<pre><code>## # A tibble: 506 x 14
##       crim    zn indus  chas   nox    rm   age   dis   rad   tax ptratio
##      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 0.00632  18    2.31     0 0.538  6.58  65.2  4.09     1   296    15.3
##  2 0.0273    0    7.07     0 0.469  6.42  78.9  4.97     2   242    17.8
##  3 0.0273    0    7.07     0 0.469  7.18  61.1  4.97     2   242    17.8
##  4 0.0324    0    2.18     0 0.458  7.00  45.8  6.06     3   222    18.7
##  5 0.0690    0    2.18     0 0.458  7.15  54.2  6.06     3   222    18.7
##  6 0.0298    0    2.18     0 0.458  6.43  58.7  6.06     3   222    18.7
##  7 0.0883   12.5  7.87     0 0.524  6.01  66.6  5.56     5   311    15.2
##  8 0.145    12.5  7.87     0 0.524  6.17  96.1  5.95     5   311    15.2
##  9 0.211    12.5  7.87     0 0.524  5.63 100    6.08     5   311    15.2
## 10 0.170    12.5  7.87     0 0.524  6.00  85.9  6.59     5   311    15.2
## # … with 496 more rows, and 3 more variables: black &lt;dbl&gt;, lstat &lt;dbl&gt;,
## #   medv &lt;dbl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?MASS<span class="op">::</span>Boston</code></pre></div>
<ul>
<li>crim per capita crime rate by town.</li>
<li>zn proportion of residential land zoned for lots over 25,000 sq.ft.</li>
<li>indus proportion of non-retail business acres per town.</li>
<li>chas Charles River dummy variable (= 1 if tract bounds river; 0 otherwise).</li>
<li>nox nitrogen oxides concentration (parts per 10 million).</li>
<li>rm average number of rooms per dwelling.</li>
<li>age proportion of owner-occupied units built prior to 1940.</li>
<li>dis weighted mean of distances to five Boston employment centres.</li>
<li>rad index of accessibility to radial highways.</li>
<li>tax full-value property-tax rate per $10,000.</li>
<li>ptratio pupil-teacher ratio by town.</li>
<li>black <span class="math inline">\(1000(Bk - 0.63)^2\)</span> where Bk is the proportion of blacks by town.</li>
<li>lstat lower status of the population (percent).</li>
<li>medv median value of owner-occupied homes in $1000s.</li>
</ul>
<p>A ggplot is the first declaration (usually variable <code>data</code> is defined), followed by graphics definitions (operations on the data):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> boston) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rm, <span class="dt">y =</span> medv), <span class="dt">alpha=</span><span class="fl">0.4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;avg. rooms per house&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;median house value&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;House values vs. size in Boston&quot;</span>)</code></pre></div>
<p><img src="tidyverse-class_files/figure-html/price-rooms-1-1.png" width="672" /></p>
<p>Making a histogram of all numeric variables. First step, gather all variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># strips all non-numeric columns (unnecessary here)</span>
<span class="st">  </span><span class="kw">gather</span>()  <span class="co"># puts all variable values in a single column &#39;value&#39;</span></code></pre></div>
<pre><code>## # A tibble: 7,084 x 2
##    key     value
##    &lt;chr&gt;   &lt;dbl&gt;
##  1 crim  0.00632
##  2 crim  0.0273 
##  3 crim  0.0273 
##  4 crim  0.0324 
##  5 crim  0.0690 
##  6 crim  0.0298 
##  7 crim  0.0883 
##  8 crim  0.145  
##  9 crim  0.211  
## 10 crim  0.170  
## # … with 7,074 more rows</code></pre>
<p>Facet wrap allows plotting each <code>key</code> level separately.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(value), <span class="dt">bins=</span><span class="dv">20</span>)</code></pre></div>
<p><img src="tidyverse-class_files/figure-html/all-var-hist-1.png" width="672" /></p>
<p>From the histograms, there seems to be only a few values of <code>crim</code> over 30.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(crim <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>)</code></pre></div>
<pre><code>## # A tibble: 8 x 14
##    crim    zn indus  chas   nox    rm   age   dis   rad   tax ptratio black
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1  89.0     0  18.1     0 0.671  6.97  91.9  1.42    24   666    20.2 397. 
## 2  38.4     0  18.1     0 0.693  5.45 100    1.49    24   666    20.2 397. 
## 3  41.5     0  18.1     0 0.693  5.53  85.4  1.61    24   666    20.2 329. 
## 4  67.9     0  18.1     0 0.693  5.68 100    1.43    24   666    20.2 385. 
## 5  51.1     0  18.1     0 0.597  5.76 100    1.41    24   666    20.2   2.6
## 6  45.7     0  18.1     0 0.693  4.52 100    1.66    24   666    20.2  88.3
## 7  73.5     0  18.1     0 0.679  5.96 100    1.80    24   666    20.2  16.4
## 8  37.7     0  18.1     0 0.679  6.20  78.7  1.86    24   666    20.2  18.8
## # … with 2 more variables: lstat &lt;dbl&gt;, medv &lt;dbl&gt;</code></pre>
</div>
<div id="ggplot2-and-eda" class="section level2">
<h2><span class="header-section-number">1.2</span> ggplot2 and EDA</h2>
<p>But we want to know the conditional distributions according to <code>medv</code>. First, showing this with conditional densities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&#39;key&#39;</span>, <span class="st">&#39;value&#39;</span>, <span class="op">-</span>medv) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">price_gr =</span> <span class="kw">ntile</span>(medv, <span class="dv">4</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(value, <span class="dt">group =</span> price_gr)) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>key, <span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_freqpoly</span>(<span class="kw">aes</span>(<span class="dt">color =</span> price_gr), <span class="dt">bins =</span> <span class="dv">12</span>)</code></pre></div>
<p><img src="tidyverse-class_files/figure-html/cond-hist-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Click on the expand icon at the top right to make bigger.</span></code></pre></div>
<p>Appears <code>chas</code> is categorical.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston &lt;-<span class="st"> </span>boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">chas =</span> <span class="kw">factor</span>(chas))</code></pre></div>
<p>Second, scatterplots of median value vs. all variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&#39;key&#39;</span>, <span class="st">&#39;value&#39;</span>, <span class="op">-</span><span class="kw">c</span>(medv, chas)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> medv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> chas), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">lwd =</span> <span class="fl">0.5</span>, <span class="dt">se =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggsave</span>(<span class="st">&#39;plots/medv-scatter.pdf&#39;</span>)</code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/medv-scatter-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Click on the expand icon at the top right to make bigger.</span></code></pre></div>
<p>There are ggplot jitter options, but none worked for me.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&#39;key&#39;</span>, <span class="st">&#39;value&#39;</span>, <span class="op">-</span><span class="kw">c</span>(medv, chas)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> medv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> chas), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">lwd =</span> <span class="fl">0.5</span>, <span class="dt">se =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/medv-jitter-nw-1.png" width="672" /></p>
<p>Tinkering to get a jittered plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">var_sd &lt;-<span class="st"> </span>boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&#39;key&#39;</span>, <span class="st">&#39;value&#39;</span>, <span class="op">-</span><span class="kw">c</span>(medv, chas)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">var_sd =</span> <span class="kw">sd</span>(value))
boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&#39;key&#39;</span>, <span class="st">&#39;value&#39;</span>, <span class="op">-</span><span class="kw">one_of</span>(<span class="kw">c</span>(<span class="st">&quot;medv&quot;</span>, <span class="st">&quot;chas&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="dt">y =</span> var_sd, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">jit_val =</span> value <span class="op">+</span><span class="st"> </span>var_sd <span class="op">*</span><span class="st"> </span><span class="kw">runif</span>(<span class="kw">nrow</span>(boston), <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> jit_val, <span class="dt">y =</span> medv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> chas), <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">lwd =</span> <span class="fl">0.5</span>, <span class="dt">se =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggsave</span>(<span class="st">&#39;plots/medv-jitter.pdf&#39;</span>)</code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;
## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/medv-jitter-1.png" width="672" /></p>
<p>Covariance plot of variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">cor</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">name =</span> <span class="kw">colnames</span>(boston[<span class="kw">sapply</span>(boston, is.numeric)])) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>( , , <span class="op">-</span><span class="kw">one_of</span>(<span class="st">&quot;name&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(name, key, <span class="dt">fill =</span> value)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_tile</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">mid =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>,
                         <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, , <span class="dt">by =</span> <span class="fl">0.2</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.key.height =</span> <span class="kw">unit</span>(<span class="dv">45</span>, <span class="st">&quot;pt&quot;</span>))</code></pre></div>
<p><img src="tidyverse-class_files/figure-html/cov-plot-1.png" width="672" /> But a better correlation plot is in a package designed for them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(corrplot)</code></pre></div>
<pre><code>## corrplot 0.84 loaded</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">cor</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">abs</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">corrplot</span>(<span class="dt">cl.lim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="tidyverse-class_files/figure-html/using-corrplot-1.png" width="672" /></p>
<p>Analyze median value and highway access <code>rad</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rad, medv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">color =</span> chas), 
              <span class="dt">height =</span> <span class="dv">2</span>, <span class="dt">width =</span> <span class="ot">NULL</span>, 
              <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">color =</span> chas), <span class="dt">lwd =</span> <span class="dv">1</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/medv-rad-1.png" width="672" /></p>
<p>Perhaps <code>rad = 24</code> is a missing value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(rad)</code></pre></div>
<pre><code>## # A tibble: 9 x 2
##     rad     n
##   &lt;int&gt; &lt;int&gt;
## 1     1    20
## 2     2    24
## 3     3    38
## 4     4   110
## 5     5   115
## 6     6    26
## 7     7    17
## 8     8    24
## 9    24   132</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>( , , <span class="op">-</span>rad) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(key, rad) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">as.numeric</span>(value)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># necessary due to factor variable chas</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">z =</span> <span class="kw">round</span>(<span class="kw">mean</span>(value), <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(rad, z)</code></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 13 x 10
## # Groups:   key [13]
##    key       `1`   `2`   `3`   `4`   `5`   `6`   `7`   `8`  `24`
##    &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 age      45    64.8  49.3  60.8  69.2  60.1  40.1  67.3  89.8
##  2 black   389.  386.  392.  383.  369.  387.  388.  385.  288. 
##  3 chas      0     0     0.1   0.1   0.1   0     0     0.2   0.1
##  4 crim      0     0.1   0.1   0.4   0.7   0.2   0.2   0.4  12.8
##  5 dis       6     4.1   5.1   4.4   3.7   4     6.5   4.4   2.1
##  6 indus     5.1   9.6   4.4  10.7   9.8   8.2   5     5.9  18.1
##  7 lstat     7.4  10     9.1  12.2  10.7  12.3   8     8    18.6
##  8 medv     24.4  26.8  27.9  21.4  25.7  21    27.1  30.4  16.4
##  9 nox       0.5   0.5   0.5   0.5   0.6   0.5   0.4   0.5   0.7
## 10 ptratio  17.6  17.3  18.2  19.1  16.5  17.8  18.4  18    20.2
## 11 rm        6.6   6.6   6.5   6.1   6.4   6.1   6.6   7     6  
## 12 tax     291.  261.  246.  336   332.  373.  304.  301.  666  
## 13 zn       39.9  20.4  16.4  14.7  11.1  13    26.7   6.2   0</code></pre>
<p>Or in helpful boxplot format.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>( , , <span class="op">-</span>rad) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(key, rad) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rad, <span class="dt">y =</span> value, <span class="dt">group =</span> rad)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.size =</span> <span class="fl">0.5</span>, <span class="dt">varwidth =</span> T) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>key, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggsave</span>(<span class="st">&#39;plots/rad-boxplot.pdf&#39;</span>)</code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<p><img src="tidyverse-class_files/figure-html/boxplot-rad-1.png" width="672" /></p>
<p>Looking at <code>lstat</code> relationships.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">keep</span>(is.numeric) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>( , , <span class="op">-</span>lstat) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lstat_gr =</span> <span class="kw">ntile</span>(lstat, <span class="dv">10</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(key, lstat_gr) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lstat_gr, <span class="dt">y =</span> value, <span class="dt">group =</span> lstat_gr)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_violin</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>key, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggsave</span>(<span class="st">&#39;plots/lstat-violin.pdf&#39;</span>)</code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<p><img src="tidyverse-class_files/figure-html/violin-lstat-1.png" width="672" /></p>
<p>Jittering works well for single plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(tax, nox)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">color =</span> medv, <span class="dt">shape =</span> chas), 
                <span class="dt">height =</span> <span class="fl">0.02</span>, <span class="dt">width =</span> <span class="dv">10</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_color_gradient2</span>(<span class="dt">midpoint =</span> <span class="dv">20</span>, 
                          <span class="dt">low =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">mid =</span> <span class="st">&quot;gray75&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.6</span>, <span class="dt">color =</span> <span class="st">&quot;yellow&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="fl">0.001</span>, <span class="dt">intercept =</span> <span class="fl">0.1</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&quot;93133313&quot;</span>)</code></pre></div>
<p><img src="tidyverse-class_files/figure-html/tax-nox-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">ggsave</span>(<span class="st">&#39;plots/tax-nox.pdf&#39;</span>)</code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
</div>
<div id="many-plotting-options" class="section level2">
<h2><span class="header-section-number">1.3</span> Many plotting options</h2>
<p>Statistics can be added to the plot as an additional layer. Other layers are coordinates, facets, and scales.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> boston) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rm, <span class="dt">y =</span> medv, <span class="dt">color =</span> crim), <span class="dt">alpha=</span><span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rm, <span class="dt">y =</span> medv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">4.5</span>, <span class="fl">7.5</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;average rooms / house&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;median house price ($K)&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;Boston median house prices vs. average house size&quot;</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/price-rooms-2-1.png" width="672" /></p>
<p>Maybe more useful if colored by quantile of <code>crim</code> value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">crim =</span> <span class="kw">cume_dist</span>(crim)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rm, <span class="dt">y =</span> medv, <span class="dt">color =</span> crim), <span class="dt">alpha=</span><span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rm, <span class="dt">y =</span> medv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">4.5</span>, <span class="fl">7.5</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_color_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;average rooms / house&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;median house price ($K)&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;Boston median house prices, house size, and crime&quot;</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/price-rooms-3-1.png" width="672" /></p>
<p>Now color by <code>rad</code> but change all 24’s to NA’s.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rad =</span> <span class="kw">ifelse</span>(rad <span class="op">==</span><span class="st"> </span><span class="dv">24</span>, <span class="ot">NA</span>, rad)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rm, <span class="dt">y =</span> medv, <span class="dt">color =</span> rad), <span class="dt">alpha=</span><span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rm, <span class="dt">y =</span> medv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">4.5</span>, <span class="fl">7.5</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_color_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">na.value =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;average rooms / house&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;median house price ($K)&quot;</span>,
         <span class="dt">title =</span> <span class="st">&quot;Boston median house prices and access to radial highways&quot;</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/price-rad-na-1.png" width="672" /></p>
<p>Maybe excluding newly-NA’ed <code>rad</code> values helps the crime plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>rad <span class="op">==</span><span class="st"> </span><span class="dv">24</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">crim =</span> <span class="kw">cume_dist</span>(crim)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rm, <span class="dt">y =</span> medv, <span class="dt">color =</span> crim), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> rm, <span class="dt">y =</span> medv), <span class="dt">lwd =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_color_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;average rooms / house&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;median house price ($K)&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;Boston median house prices, house size, and crime&quot;</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/price-rooms-4-1.png" width="672" /></p>
<p>A grid of <code>nox</code> vs. <code>dis</code> plots according to <code>chas</code> (rows) and binned level (ntile) of <code>rad</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rad =</span> <span class="kw">ifelse</span>(rad <span class="op">==</span><span class="st"> </span><span class="dv">24</span>, <span class="ot">NA</span>, rad)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(rad)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(nox, dis, <span class="dt">color =</span> medv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_jitter</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(chas <span class="op">~</span><span class="st"> </span><span class="kw">ntile</span>(rad, <span class="dv">3</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/facet-grid-1.png" width="672" /></p>
<p>Multiplots available with <code>gridExtra</code>, used by ggplot2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(gridExtra)</code></pre></div>
<pre><code>## Loading required package: gridExtra</code></pre>
<pre><code>## 
## Attaching package: &#39;gridExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(boston) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(nox, medv, <span class="dt">shape =</span> chas, <span class="dt">alpha =</span> <span class="kw">cume_dist</span>(lstat)), 
             <span class="dt">color =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;using aes(alpha, shape)&#39;</span>)
p2 &lt;-<span class="st"> </span>boston <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lstat_gr =</span> <span class="kw">ntile</span>(lstat, <span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(tax, medv, <span class="dt">color =</span> lstat_gr, <span class="dt">size =</span> nox)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">16</span>, <span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">group =</span> lstat_gr), <span class="dt">lwd =</span> <span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;using aes(group, size)&#39;</span>)
p1</code></pre></div>
<p><img src="tidyverse-class_files/figure-html/multiple-plots-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p2</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="tidyverse-class_files/figure-html/multiple-plots-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggsave</span>(<span class="st">&#39;plots/two-plot.pdf&#39;</span>, <span class="kw">arrangeGrob</span>(p1, p2))</code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-dplyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["tidyverse-class.pdf", "tidyverse-class.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
